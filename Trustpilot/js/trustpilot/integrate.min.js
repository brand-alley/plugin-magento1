function JSONParseSafe(e){try{return JSON.parse(e)}catch(e){return null}}function receiveSettings(e){if(e.origin===location.origin)return receiveInternalData(e);const t=document.getElementById("configuration_iframe").dataset;if(e.origin!==t.transfer)return;const n=e.data;if("string"==typeof n)if(n.startsWith("sync:")||n.startsWith("showPastOrdersInitial:")){const e=n.split(":"),t={action:"handle_past_orders"};t[e[0]]=e[1],this.submitPastOrdersCommand(t)}else if(n.startsWith("resync")){const e={action:"handle_past_orders",resync:"resync"};this.submitPastOrdersCommand(e)}else if(n.startsWith("issynced")){const e={action:"handle_past_orders",issynced:"issynced"};this.submitPastOrdersCommand(e)}else if(n.startsWith("check_product_skus")){const e=n.split(":"),t={action:"check_product_skus"};t.skuSelector=e[1],this.submitCheckProductSkusCommand(t)}else"signup_data"===n?this.sendSignupData():"update"===n?updateplugin():"reload"===n?reloadSettings():handleJSONMessage(n)}function receiveInternalData(e){const t=e.data;if(t&&"string"==typeof t){const e=JSONParseSafe(t);e&&"loadCategoryProductInfo"===e.type&&requestCategoryInfo(),e&&"updatePageUrls"===e.type&&submitSettings(e),e&&"newTrustBox"===e.type&&submitSettings(e)}}function requestCategoryInfo(){const e={action:"get_category_product_info",form_key:window.FORM_KEY};"undefined"!=typeof websiteId&&(e.website_id=websiteId),"undefined"!=typeof storeId&&(e.store_id=storeId);const t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):window.postMessage(t.response,window.origin))},t.open("POST",ajaxUrl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(encodeSettings(e))}function handleJSONMessage(e){const t=JSONParseSafe(e);if(t&&t.TrustBoxPreviewMode)TrustBoxPreviewMode(e);else if(t&&t.window)this.updateIframeSize(t);else if(t&&"submit"===t.type)this.submitSettings(t);else if(t&&t.trustbox){document.getElementById("trustbox_preview_frame").contentWindow.postMessage(JSON.stringify(t.trustbox),"*")}}function encodeSettings(e){let t="";for(const n in e)t+=`${n}=${e[n]}&`;return t.substring(0,t.length-1)}function getFormValues(e){let t={};for(const n in e.elements){const s=e.elements[n];"INPUT"===s.nodeName&&(t[s.name]=s.value)}return t}function submitPastOrdersCommand(e){e.form_key=window.FORM_KEY,"undefined"!=typeof websiteId&&(e.website_id=websiteId),"undefined"!=typeof storeId&&(e.store_id=storeId);const t=new XMLHttpRequest;t.open("POST",ajaxUrl,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):sendPastOrdersInfo(t.response))},t.send(encodeSettings(e))}function submitCheckProductSkusCommand(e){e.form_key=window.FORM_KEY;const t=new XMLHttpRequest;t.open("POST",ajaxUrl,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings(e))}function sendSignupData(){const e={action:"get_signup_data",form_key:window.FORM_KEY};"undefined"!=typeof websiteId&&(e.website_id=websiteId),"undefined"!=typeof storeId&&(e.store_id=storeId);const t=new XMLHttpRequest;t.open("POST",ajaxUrl,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe"),n=JSON.stringify({trustpilot_signup_data:t.response});e.contentWindow.postMessage(n,e.dataset.transfer)}},t.send(encodeSettings(e))}function updateplugin(){const e={action:"update_trustpilot_plugin",form_key:window.FORM_KEY},t=new XMLHttpRequest;t.open("POST",ajaxUrl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(encodeSettings(e))}function TrustBoxPreviewMode(e){const t=JSONParseSafe(e),n=document.getElementById("trustpilot-trustbox-preview");t&&t.TrustBoxPreviewMode.enable?n.hidden=!1:n.hidden=!0}function reloadSettings(){const e={action:"reload_trustpilot_settings",form_key:window.FORM_KEY},t=new XMLHttpRequest;t.open("POST",ajaxUrl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings(e))}function submitSettings(e){const t={action:"handle_save_changes",form_key:window.FORM_KEY};if("updatePageUrls"===e.type)t.pageUrls=encodeURIComponent(JSON.stringify(e.pageUrls));else if("newTrustBox"===e.type)t.customTrustBoxes=encodeURIComponent(JSON.stringify(e));else{t.settings=encodeURIComponent(JSON.stringify(e.settings));const n=document.getElementById("trustbox_preview_frame");n?n.dataset.settings=btoa(t.settings):console.log("trustbox_preview_frame is missing. Skipping...")}"undefined"!=typeof websiteId&&(t.website_id=websiteId),"undefined"!=typeof storeId&&(t.store_id=storeId);const n=new XMLHttpRequest;n.open("POST",ajaxUrl),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(encodeSettings(t))}function updateIframeSize(e){const t=document.getElementById("configuration_iframe");t&&(t.height=e.window.height+"px")}function sendSettings(){const e=document.getElementById("configuration_iframe"),t=e.dataset,n=JSON.parse(atob(t.settings));if(n.trustbox||(n.trustbox={}),n.trustbox.pageUrls=JSON.parse(atob(t.pageUrls)),n.pluginVersion=t.pluginVersion,n.source=t.source,n.version=t.version,n.basis="plugin",n.productIdentificationOptions=JSON.parse(t.productIdentificationOptions),n.isFromMarketplace=t.isFromMarketplace,n.configurationScopeTree=JSON.parse(atob(t.configurationScopeTree)),n.pluginStatus=JSON.parse(atob(t.pluginStatus)),n.trustbox.trustboxes&&t.sku)for(trustbox of n.trustbox.trustboxes)trustbox.sku=t.sku;if(n.trustbox.trustboxes&&t.name)for(trustbox of n.trustbox.trustboxes)trustbox.name=t.name;e.contentWindow.postMessage(JSON.stringify(n),t.transfer)}function sendPastOrdersInfo(e){const t=document.getElementById("configuration_iframe"),n=t.dataset;void 0===e&&(e=n.pastOrders),t.contentWindow.postMessage(e,n.transfer)}window.addEventListener("message",this.receiveSettings);
//# sourceMappingURL=integrate.min.js.map
